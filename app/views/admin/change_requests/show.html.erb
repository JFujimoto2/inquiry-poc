<div class="bg-white shadow rounded p-6">
  <div class="flex justify-between items-start mb-4">
    <h1 class="text-2xl font-bold">Change Request #<%= @change_request.id %></h1>
    <span class="px-3 py-1 rounded text-sm <%= change_request_status_class(@change_request.status) %>">
      <%= @change_request.status.titleize %>
    </span>
  </div>

  <dl class="space-y-2">
    <dt class="font-medium text-gray-600">Customer</dt>
    <dd class="mb-3"><%= link_to @change_request.customer.company_name, admin_customer_path(@change_request.customer), class: "text-blue-600 hover:underline" %></dd>

    <dt class="font-medium text-gray-600">Reservation</dt>
    <dd class="mb-3"><%= link_to "##{@change_request.reservation.id} - #{@change_request.reservation.facility.name}", admin_reservation_path(@change_request.reservation), class: "text-blue-600 hover:underline" %></dd>

    <dt class="font-medium text-gray-600">Request Details</dt>
    <dd class="mb-3 whitespace-pre-wrap bg-gray-50 p-3 rounded"><%= @change_request.request_details %></dd>

    <dt class="font-medium text-gray-600">Submitted At</dt>
    <dd class="mb-3"><%= @change_request.created_at.strftime("%Y-%m-%d %H:%M") %></dd>

    <% if @change_request.admin_response.present? %>
      <dt class="font-medium text-gray-600">Admin Response</dt>
      <dd class="mb-3 whitespace-pre-wrap bg-gray-50 p-3 rounded"><%= @change_request.admin_response %></dd>
    <% end %>
  </dl>

  <% if @change_request.status == "pending" %>
    <div class="mt-6 border-t pt-4">
      <h3 class="font-medium mb-2">Respond</h3>
      <%= form_with(model: [:admin, @change_request], url: respond_admin_change_request_path(@change_request), method: :patch, class: "space-y-4") do |form| %>
        <div>
          <%= form.label :admin_response, "Response Message", class: "block font-medium mb-1" %>
          <%= form.text_area :admin_response, rows: 4, class: "w-full border rounded p-2" %>
        </div>

        <div class="flex gap-2">
          <%= form.submit "Approve", name: "change_request[status]", value: "approved",
              class: "bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 cursor-pointer" %>
          <%= form.submit "Reject", name: "change_request[status]", value: "rejected",
              class: "bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 cursor-pointer" %>
        </div>
      <% end %>
    </div>
  <% end %>

  <div class="mt-6 flex space-x-4">
    <%= link_to "Back", admin_change_requests_path, class: "text-blue-600 hover:underline" %>
  </div>
</div>
