<div class="bg-white shadow rounded p-6">
  <div class="flex justify-between items-start mb-4">
    <h1 class="text-2xl font-bold">予約詳細</h1>
    <span class="px-3 py-1 rounded text-sm <%= reservation_status_class(@reservation.status) %>">
      <%= reservation_status_label(@reservation.status) %>
    </span>
  </div>

  <dl class="space-y-2">
    <dt class="font-medium text-gray-600">施設</dt>
    <dd class="mb-3"><%= @reservation.facility.name %></dd>

    <dt class="font-medium text-gray-600">チェックイン日</dt>
    <dd class="mb-3"><%= @reservation.check_in_date %></dd>

    <% if @reservation.check_out_date %>
      <dt class="font-medium text-gray-600">チェックアウト日</dt>
      <dd class="mb-3"><%= @reservation.check_out_date %></dd>
    <% end %>

    <dt class="font-medium text-gray-600">利用人数</dt>
    <dd class="mb-3"><%= @reservation.num_people %></dd>

    <% if @reservation.total_amount %>
      <dt class="font-medium text-gray-600">合計金額</dt>
      <dd class="mb-3"><%= number_to_currency(@reservation.total_amount, unit: "¥", precision: 0) %></dd>
    <% end %>

    <% if @reservation.confirmed_at %>
      <dt class="font-medium text-gray-600">確定日時</dt>
      <dd class="mb-3"><%= @reservation.confirmed_at.strftime("%Y-%m-%d %H:%M") %></dd>
    <% end %>
  </dl>

  <div class="mt-6 flex space-x-4">
    <% if @reservation.status.in?(%w[pending_confirmation confirmed]) %>
      <%= link_to "変更リクエスト", new_mypage_reservation_change_request_path(@reservation), class: "bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600" %>
    <% end %>
    <%= link_to "ダッシュボードに戻る", mypage_root_path, class: "text-blue-600 hover:underline self-center" %>
  </div>
</div>

<% if @reservation.change_requests.any? %>
  <div class="mt-8">
    <h2 class="text-xl font-bold mb-4">変更リクエスト</h2>
    <div class="space-y-4">
      <% @reservation.change_requests.order(created_at: :desc).each do |cr| %>
        <div class="bg-white shadow rounded p-4">
          <div class="flex justify-between items-start">
            <p class="text-gray-700"><%= cr.request_details %></p>
            <span class="px-2 py-1 rounded text-sm <%= change_request_status_class(cr.status) %>">
              <%= change_request_status_label(cr.status) %>
            </span>
          </div>
          <% if cr.admin_response.present? %>
            <p class="mt-2 text-sm text-gray-600"><strong>回答:</strong> <%= cr.admin_response %></p>
          <% end %>
          <p class="mt-1 text-xs text-gray-400"><%= cr.created_at.strftime("%Y-%m-%d %H:%M") %></p>
        </div>
      <% end %>
    </div>
  </div>
<% end %>
